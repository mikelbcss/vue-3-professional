```vue
<template>
  <div class="message-formatter" :class="containerClass">
    <h2>{{ props.title || 'Formateador de Mensajes - Vue 3' }}</h2>

    <!-- Input with template ref -->
    <div class="input-section">
      <label>Escribe tu mensaje:</label>
      <input ref="messageInput" v-model="message" type="text" placeholder="Escribe algo..." class="input-field" />
      <button @click="focusInput">Enfocar Input</button>
    </div>

    <!-- Display formatted message using computed properties -->
    <div class="output-section">
      <h3>Mensaje formateado:</h3>
      <p class="formatted-message" :class="messageClass">
        {{ formattedMessage }}
      </p>
      <p class="char-count">Caracteres: {{ message.length }}</p>
    </div>

    <!-- Theme controls -->
    <div class="controls">
      <label>
        <input type="checkbox" v-model="isDarkMode" />
        Modo oscuro
      </label>

      <label>
        Tama√±o del texto:
        <select v-model="fontSize">
          <option value="small">Peque√±o</option>
          <option value="medium">Mediano</option>
          <option value="large">Grande</option>
        </select>
      </label>
    </div>

    <!-- Action button -->
    <div class="actions">
      <button @click="sendMessage" :disabled="!message.trim()" class="send-button">Enviar Mensaje</button>
    </div>

    <!-- Status display -->
    <div class="status" v-if="lastSentMessage">
      <p>
        √öltimo mensaje enviado: <strong>{{ lastSentMessage }}</strong>
      </p>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch } from 'vue'

// Props definition with TypeScript
const props = defineProps<{
  title?: string
}>()

// Emits definition with TypeScript
const emit = defineEmits<{
  'message-sent': [payload: { original: string; formatted: string; timestamp: string }]
}>()

// Reactive state using ref()
const message = ref('')
const isDarkMode = ref(false)
const fontSize = ref<'small' | 'medium' | 'large'>('medium')
const lastSentMessage = ref('')
const charCountColor = ref('#333')

// Template ref for DOM access - templateRef
const messageInput = ref<HTMLInputElement>()

// Helper functions (replacing filters)
const capitalize = (value: string): string => {
  if (!value) return ''
  return value.charAt(0).toUpperCase() + value.slice(1)
}

const addPrefix = (value: string): string => {
  if (!value) return ''
  return `üìù ${value}`
}

// Computed properties
const containerClass = computed(() => ({
  'dark-mode': isDarkMode.value,
  'light-mode': !isDarkMode.value,
}))

const messageClass = computed(() => ({
  'has-content': message.value.length > 0,
  'long-message': message.value.length > 20,
}))

const fontSizeValue = computed(() => {
  const sizes = {
    small: '14px',
    medium: '16px',
    large: '18px',
  }
  return sizes[fontSize.value]
})

const textColor = computed(() => {
  return isDarkMode.value ? '#fff' : charCountColor.value
})

// Computed property replacing filters
const formattedMessage = computed(() => {
  return addPrefix(capitalize(message.value))
})

// Watchers - Aunque mejor computed
watch(message, newMessage => {
  console.log('üí¨ Message changed:', newMessage)

  // Update character count color based on length
  if (newMessage.length > 50) {
    charCountColor.value = '#e74c3c'
  } else if (newMessage.length > 20) {
    charCountColor.value = '#f39c12'
  } else {
    charCountColor.value = '#27ae60'
  }
})

watch(isDarkMode, newValue => {
  console.log('üåì Theme changed to:', newValue ? 'dark' : 'light')
})

watch(fontSize, newSize => {
  console.log('üìù Font size changed to:', newSize)
})

// Methods as functions
const focusInput = () => {
  messageInput.value?.focus()
  console.log('üéØ Input focused using template ref')
}

const sendMessage = () => {
  if (message.value.trim()) {
    const formatted = formattedMessage.value

    // Update last sent message
    lastSentMessage.value = formatted

    // Emit event to parent
    emit('message-sent', {
      original: message.value,
      formatted,
      timestamp: new Date().toISOString(),
    })

    console.log('üì§ Message sent:', formatted)

    // Clear message after sending
    message.value = ''
  }
}
</script>

<style scoped>
.message-formatter {
  max-width: 500px;
  margin: 0 auto;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  font-size: v-bind(fontSizeValue);
  transition: all 0.3s ease;
}

.light-mode {
  background-color: #ffffff;
  color: #333333;
}

.dark-mode {
  background-color: #2c3e50;
  color: #ecf0f1;
}

.input-section {
  margin-bottom: 20px;
}

.input-field {
  width: 100%;
  padding: 8px 12px;
  margin: 8px 0;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: inherit;
}

.dark-mode .input-field {
  background-color: #34495e;
  border-color: #7f8c8d;
  color: #ecf0f1;
}

.output-section {
  margin-bottom: 20px;
}

.formatted-message {
  padding: 10px;
  background-color: #f8f9fa;
  border-radius: 4px;
  font-weight: bold;
  min-height: 20px;
}

.dark-mode .formatted-message {
  background-color: #34495e;
}

.formatted-message.has-content {
  border-left: 4px solid #3498db;
}

.formatted-message.long-message {
  border-left-color: #e74c3c;
}

.char-count {
  font-size: 0.9em;
  margin-top: 5px;
  color: v-bind(textColor);
}

.controls {
  margin-bottom: 20px;
}

.controls label {
  display: block;
  margin-bottom: 10px;
}

.controls select {
  margin-left: 8px;
  padding: 4px 8px;
}

.actions {
  margin-bottom: 20px;
}

.send-button {
  background-color: #3498db;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 4px;
  cursor: pointer;
  font-size: inherit;
}

.send-button:hover:not(:disabled) {
  background-color: #2980b9;
}

.send-button:disabled {
  background-color: #bdc3c7;
  cursor: not-allowed;
}

.status {
  background-color: #d4edda;
  border: 1px solid #c3e6cb;
  color: #155724;
  padding: 10px;
  border-radius: 4px;
}

.dark-mode .status {
  background-color: #1e3a2e;
  border-color: #2d5a3d;
  color: #a3d9b1;
}
</style>
```

## Explicaci√≥n de la soluci√≥n

### Cambios principales de Vue 2 a Vue 3

#### 1. **Script Setup con TypeScript**

- Cambi√≥ de Options API a Composition API
- Uso de `<script setup lang="ts">` para mejor DX y tipos
- TypeScript completo para mayor seguridad de tipos

#### 2. **Props y Emits tipados**

```typescript
// Vue 2: props: { title: String }
const props = defineProps<{ title?: string }>()

// Vue 2: this.$emit('message-sent', data)
const emit = defineEmits<{ 'message-sent': [payload] }>()
```

#### 3. **Reactividad**

```typescript
// Vue 2: data() { return { message: '' } }
const message = ref('')

// Vue 2: this.message
message.value // en JavaScript, message en template
```

#### 4. **Migraci√≥n de Filters**

**Vue 2:**

```javascript
{{ message | capitalize | addPrefix }}
filters: {
  capitalize(value) { ... },
  addPrefix(value) { ... }
}
```

**Vue 3:**

```typescript
// Opci√≥n 1: Computed property (recomendado)
const formattedMessage = computed(() => {
  return addPrefix(capitalize(message.value))
})

// Opci√≥n 2: Funciones helper
const capitalize = (value: string): string => { ... }
```

#### 5. **Template Refs**

```typescript
// Vue 2: this.$refs.messageInput
const messageInput = ref<HTMLInputElement>()
messageInput.value?.focus()
```

#### 6. **Watchers**

```typescript
// Vue 2: watch: { message(newVal) { ... } }
watch(message, newMessage => {
  console.log('Changed:', newMessage)
})
```

#### 7. **v-bind en CSS**

```css
/* Nueva funcionalidad de Vue 3 */
.message-formatter {
  font-size: v-bind(fontSizeValue);
  color: v-bind(textColor);
}
```

### Beneficios de la migraci√≥n

1. **Mejor rendimiento**: No hay overhead de filters
2. **Tree-shaking**: Solo importa lo que usa
3. **TypeScript**: Tipos seguros y mejor IDE support
4. **Composition API**: L√≥gica m√°s reutilizable
5. **v-bind CSS**: Estilos din√°micos m√°s eficientes
6. **Mejor DX**: Autocompletado y detecci√≥n de errores

### Conceptos aplicados

- ‚úÖ **Filters ‚Üí Computed/Functions**: Migraci√≥n completa
- ‚úÖ **Template Refs**: `ref<HTMLElement>()`
- ‚úÖ **Watchers**: `watch()` con tipado
- ‚úÖ **Class/Style Bindings**: Computed properties + v-bind CSS
- ‚úÖ **Emits**: `defineEmits()` tipado
- ‚úÖ **Props**: `defineProps()` tipado
